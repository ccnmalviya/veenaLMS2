module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},59485,(e,t,r)=>{t.exports=e.x("@aws-sdk/client-s3",()=>require("@aws-sdk/client-s3"))},4397,e=>{"use strict";var t=e.i(42189),r=e.i(90238),a=e.i(81840),s=e.i(72684),n=e.i(3821),o=e.i(29244),i=e.i(86433),l=e.i(40785),d=e.i(46177),c=e.i(3994),u=e.i(13017),p=e.i(91048),h=e.i(27661),m=e.i(37931),f=e.i(25278),x=e.i(54545),v=e.i(93695);e.i(97991);var R=e.i(9787),g=e.i(19258),E=e.i(59485);let w=process.env.AWS_REGION||"us-east-1",y=process.env.AWS_ACCESS_KEY_ID,S=process.env.AWS_SECRET_ACCESS_KEY,A=process.env.AWS_S3_BUCKET_NAME;y&&S||console.error("Missing AWS credentials in environment variables"),A||console.error("Missing AWS_S3_BUCKET_NAME in environment variables");let C=new E.S3Client({region:w,credentials:{accessKeyId:y||"",secretAccessKey:S||""},forcePathStyle:!1});async function _(e){let t="products";try{let r;if(!y||!S)return g.NextResponse.json({error:"AWS credentials not configured. Please check your .env.local file."},{status:500});if(!A)return g.NextResponse.json({error:"S3 bucket name not configured. Please set AWS_S3_BUCKET_NAME in .env.local"},{status:500});let a=await e.formData(),s=a.get("file"),n=a.get("folder")||"products";if(!s)return g.NextResponse.json({error:"No file provided"},{status:400});(n=n.replace(/^\/+|\/+$/g,""))||(n="products"),t=n;let o=Date.now(),i=Math.random().toString(36).substring(2,15),l=s.name.split(".").pop(),d=`${n}/${o}-${i}.${l}`,c=await s.arrayBuffer(),u=Buffer.from(c),p=process.env.AWS_KMS_KEY_ID,h={Bucket:A,Key:d,Body:u,ContentType:s.type,ServerSideEncryption:"aws:kms"};p&&(h.SSEKMSKeyId=p);let m=new E.PutObjectCommand(h);return await C.send(m),r="us-east-1"===w?`https://${A}.s3.amazonaws.com/${d}`:`https://${A}.s3.${w}.amazonaws.com/${d}`,g.NextResponse.json({success:!0,url:r,fileName:d})}catch(r){console.error("Upload error details:",{message:r.message,name:r.name,code:r.Code||r.code,bucket:A,region:w,folder:t,hasCredentials:!!(y&&S)});let e="Upload failed";return"AccessDenied"===r.name||"AccessDenied"===r.Code||r.$metadata?.httpStatusCode===403?e=`Access Denied for folder "${t}". This is likely a folder permission issue. Please check:

1. IAM user has s3:PutObject permission for the folder path: ${t}/*
2. IAM user has kms:Decrypt and kms:GenerateDataKey permissions (for KMS encryption)
3. Bucket policy allows access to the folder: ${t}/*
4. Bucket name is correct: ${A}
5. Region is correct: ${w}

To fix folder permissions:
- Go to IAM → Your User → Permissions
- Ensure the policy includes: "s3:PutObject" with Resource: "arn:aws:s3:::${A}/${t}/*"
- Or use a broader policy like: "arn:aws:s3:::${A}/*" to allow all folders`:"NoSuchBucket"===r.name||"NoSuchBucket"===r.Code?e=`Bucket '${A}' not found. Please check AWS_S3_BUCKET_NAME in .env.local`:r.message&&(e=`${r.message} (Folder: ${t})`),g.NextResponse.json({error:e},{status:500})}}e.s(["POST",()=>_],9670);var k=e.i(9670);let b=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/Downloads/Telegram Desktop/lms-ecommerce/web/src/app/api/upload/route.ts",nextConfigOutput:"",userland:k}),{workAsyncStorage:N,workUnitAsyncStorage:T,serverHooks:P}=b;function $(){return(0,a.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:T})}async function M(e,t,a){b.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let g="/api/upload/route";g=g.replace(/\/index$/,"")||"/";let E=await b.prepare(e,t,{srcPage:g,multiZoneDraftMode:!1});if(!E)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:y,nextConfig:S,parsedUrl:A,isDraftMode:C,prerenderManifest:_,routerServerContext:k,isOnDemandRevalidate:N,revalidateOnlyGenerated:T,resolvedPathname:P,clientReferenceManifest:$,serverActionsManifest:M}=E,O=(0,l.normalizeAppPath)(g),j=!!(_.dynamicRoutes[O]||_.routes[P]),D=async()=>((null==k?void 0:k.render404)?await k.render404(e,t,A,!1):t.end("This page could not be found"),null);if(j&&!C){let e=!!_.routes[P],t=_.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await D();throw new v.NoFallbackError}}let I=null;!j||b.isDev||C||(I="/index"===(I=P)?"/":I);let K=!0===b.isDev||!j,U=j&&!K;M&&$&&(0,o.setReferenceManifestsSingleton)({page:g,clientReferenceManifest:$,serverActionsManifest:M,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:M})});let q=e.method||"GET",B=(0,n.getTracer)(),H=B.getActiveScopeSpan(),W={params:y,prerenderManifest:_,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:K,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>b.onRequestError(e,t,a,k)},sharedContext:{buildId:w}},F=new d.NodeNextRequest(e),G=new d.NodeNextResponse(t),L=c.NextRequestAdapter.fromNodeNextRequest(F,(0,c.signalFromNodeResponse)(t));try{let o=async e=>b.handle(L,W).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=B.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${q} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${g}`)}),i=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var n,l;let d=async({previousCacheEntry:r})=>{try{if(!i&&N&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(s);e.fetchMetrics=W.renderOpts.fetchMetrics;let l=W.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=W.renderOpts.collectedTags;if(!j)return await (0,h.sendResponse)(F,G,n,W.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[x.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==W.renderOpts.collectedRevalidate&&!(W.renderOpts.collectedRevalidate>=x.INFINITE_CACHE)&&W.renderOpts.collectedRevalidate,a=void 0===W.renderOpts.collectedExpire||W.renderOpts.collectedExpire>=x.INFINITE_CACHE?void 0:W.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:g,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:N})},k),t}},c=await b.handleResponse({req:e,nextConfig:S,cacheKey:I,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:_,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:T,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:i});if(!j)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",N?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,m.fromNodeOutgoingHttpHeaders)(c.value.headers);return i&&j||u.delete(x.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,f.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(F,G,new Response(c.value.body,{headers:u,status:c.value.status||200})),null};H?await l(H):await B.withPropagatedContext(e.headers,()=>B.trace(u.BaseServerSpan.handleRequest,{spanName:`${q} ${g}`,kind:n.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:N})}),j)throw t;return await (0,h.sendResponse)(F,G,new Response(null,{status:500})),null}}e.s(["handler",()=>M,"patchFetch",()=>$,"routeModule",()=>b,"serverHooks",()=>P,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>T],4397)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__e1f55b11._.js.map