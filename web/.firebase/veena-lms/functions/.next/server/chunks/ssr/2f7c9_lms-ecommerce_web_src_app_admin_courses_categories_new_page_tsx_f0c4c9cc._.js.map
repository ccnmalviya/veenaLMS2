{"version":3,"sources":["../../../../../../../../Downloads/Telegram%20Desktop/lms-ecommerce/web/src/app/admin/courses/categories/new/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { collection, addDoc, getDocs, serverTimestamp, query, where } from \"firebase/firestore\";\r\nimport { db } from \"@/lib/firebaseClient\";\r\nimport { AdminLayout } from \"@/components/admin/AdminLayout\";\r\nimport { FileUpload } from \"@/components/admin/FileUpload\";\r\n\r\nexport default function NewCourseCategoryPage() {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    slug: \"\",\r\n    image: \"\",\r\n    description: \"\",\r\n    orderIndex: 0,\r\n    status: \"active\" as \"active\" | \"inactive\",\r\n  });\r\n\r\n  const generateSlug = (name: string) => {\r\n    return name\r\n      .toLowerCase()\r\n      .trim()\r\n      .replace(/[^\\w\\s-]/g, \"\")\r\n      .replace(/[\\s_-]+/g, \"-\")\r\n      .replace(/^-+|-+$/g, \"\");\r\n  };\r\n\r\n  const checkSlugUnique = async (slug: string): Promise<boolean> => {\r\n    const q = query(collection(db, \"categories\"), where(\"slug\", \"==\", slug));\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.empty;\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    try {\r\n      setLoading(true);\r\n\r\n      // Generate slug if not provided\r\n      let finalSlug = formData.slug || generateSlug(formData.name);\r\n      \r\n      // Ensure slug is unique\r\n      let slugCounter = 1;\r\n      let uniqueSlug = finalSlug;\r\n      while (!(await checkSlugUnique(uniqueSlug))) {\r\n        uniqueSlug = `${finalSlug}-${slugCounter}`;\r\n        slugCounter++;\r\n      }\r\n\r\n      await addDoc(collection(db, \"categories\"), {\r\n        name: formData.name,\r\n        slug: uniqueSlug,\r\n        image: formData.image || null,\r\n        description: formData.description || null,\r\n        orderIndex: formData.orderIndex,\r\n        status: formData.status,\r\n        createdAt: serverTimestamp(),\r\n        updatedAt: serverTimestamp(),\r\n      });\r\n      router.push(\"/admin/courses/categories\");\r\n    } catch (error) {\r\n      console.error(\"Error creating category:\", error);\r\n      alert(\"Failed to create category\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AdminLayout>\r\n      <div className=\"space-y-6\">\r\n        <div className=\"mb-8\">\r\n          <button\r\n            onClick={() => router.back()}\r\n            className=\"text-blue-600 hover:text-blue-800 mb-4\"\r\n          >\r\n            ‚Üê Back to Categories\r\n          </button>\r\n          <h1 className=\"text-3xl font-bold text-gray-900\">New Course Category</h1>\r\n          <p className=\"text-gray-600 mt-2\">Create a new category for courses</p>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"bg-white rounded-lg shadow p-6 space-y-6\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              Category Name *\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              required\r\n              value={formData.name}\r\n              onChange={(e) => {\r\n                setFormData({ ...formData, name: e.target.value });\r\n                if (!formData.slug) {\r\n                  setFormData(prev => ({ ...prev, slug: generateSlug(e.target.value) }));\r\n                }\r\n              }}\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\r\n              placeholder=\"e.g., Programming, Design, Marketing\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Slug *</label>\r\n            <input\r\n              type=\"text\"\r\n              required\r\n              value={formData.slug}\r\n              onChange={(e) => setFormData({ ...formData, slug: generateSlug(e.target.value) })}\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\r\n              placeholder=\"e.g., programming, design, marketing\"\r\n            />\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              Auto-generated from name, but can be edited\r\n            </p>\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Image (Optional)</label>\r\n            <FileUpload\r\n              accept=\"image/*\"\r\n              folder=\"categories/images\"\r\n              currentValue={formData.image}\r\n              onUploadComplete={(url) => {\r\n                console.log(\"Upload complete, URL:\", url);\r\n                setFormData((prev) => ({ ...prev, image: url }));\r\n              }}\r\n              onUploadError={(error) => {\r\n                alert(`Upload failed: ${error}`);\r\n              }}\r\n            />\r\n            {formData.image && (\r\n              <div className=\"mt-4\">\r\n                <img\r\n                  src={formData.image}\r\n                  alt=\"Category image\"\r\n                  className=\"w-32 h-32 object-cover border border-gray-300 rounded\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setFormData((prev) => ({ ...prev, image: \"\" }))}\r\n                  className=\"mt-2 text-sm text-red-600 hover:text-red-800\"\r\n                >\r\n                  Remove Image\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Description</label>\r\n            <textarea\r\n              value={formData.description}\r\n              onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\r\n              rows={3}\r\n              placeholder=\"Brief description of this category\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Order Index</label>\r\n            <input\r\n              type=\"number\"\r\n              value={formData.orderIndex}\r\n              onChange={(e) => setFormData({ ...formData, orderIndex: parseInt(e.target.value) || 0 })}\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\r\n              placeholder=\"0\"\r\n            />\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              Lower numbers appear first in the category list\r\n            </p>\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Status</label>\r\n            <select\r\n              value={formData.status}\r\n              onChange={(e) => setFormData({ ...formData, status: e.target.value as \"active\" | \"inactive\" })}\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\r\n            >\r\n              <option value=\"active\">Active</option>\r\n              <option value=\"inactive\">Inactive</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"flex gap-4 pt-4\">\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50\"\r\n            >\r\n              {loading ? \"Creating...\" : \"Create Category\"}\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => router.back()}\r\n              className=\"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300\"\r\n            >\r\n              Cancel\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </AdminLayout>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}