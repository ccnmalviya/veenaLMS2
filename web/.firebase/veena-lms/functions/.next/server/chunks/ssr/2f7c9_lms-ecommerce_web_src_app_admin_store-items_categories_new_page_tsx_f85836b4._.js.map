{"version":3,"sources":["../../../../../../../../Downloads/Telegram%20Desktop/lms-ecommerce/web/src/app/admin/store-items/categories/new/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { collection, addDoc, getDocs, serverTimestamp, query, where } from \"firebase/firestore\";\nimport { db } from \"@/lib/firebaseClient\";\nimport { AdminLayout } from \"@/components/admin/AdminLayout\";\nimport { FileUpload } from \"@/components/admin/FileUpload\";\nimport type { Category } from \"@/types/store\";\n\nexport default function NewCategoryPage() {\n  const router = useRouter();\n  const [loading, setLoading] = useState(false);\n  const [parentCategories, setParentCategories] = useState<Category[]>([]);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    slug: \"\",\n    parentCategoryId: \"\",\n    image: \"\",\n    description: \"\",\n    orderIndex: 0,\n    status: \"active\" as \"active\" | \"inactive\",\n  });\n\n  useEffect(() => {\n    loadParentCategories();\n  }, []);\n\n  const loadParentCategories = async () => {\n    try {\n      const q = query(collection(db, \"categories\"), where(\"status\", \"==\", \"active\"));\n      const snapshot = await getDocs(q);\n      const categories: Category[] = [];\n      snapshot.forEach((doc) => {\n        categories.push({ categoryId: doc.id, ...doc.data() } as Category);\n      });\n      setParentCategories(categories);\n    } catch (error) {\n      console.error(\"Error loading categories:\", error);\n    }\n  };\n\n  const generateSlug = (name: string) => {\n    return name\n      .toLowerCase()\n      .trim()\n      .replace(/[^\\w\\s-]/g, \"\")\n      .replace(/[\\s_-]+/g, \"-\")\n      .replace(/^-+|-+$/g, \"\");\n  };\n\n  const checkSlugUnique = async (slug: string): Promise<boolean> => {\n    const q = query(collection(db, \"categories\"), where(\"slug\", \"==\", slug));\n    const snapshot = await getDocs(q);\n    return snapshot.empty;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      setLoading(true);\n\n      // Generate slug if not provided\n      let finalSlug = formData.slug || generateSlug(formData.name);\n      \n      // Ensure slug is unique\n      let slugCounter = 1;\n      let uniqueSlug = finalSlug;\n      while (!(await checkSlugUnique(uniqueSlug))) {\n        uniqueSlug = `${finalSlug}-${slugCounter}`;\n        slugCounter++;\n      }\n\n      await addDoc(collection(db, \"categories\"), {\n        name: formData.name,\n        slug: uniqueSlug,\n        parentCategoryId: formData.parentCategoryId || null,\n        image: formData.image || null,\n        description: formData.description || null,\n        orderIndex: formData.orderIndex,\n        status: formData.status,\n        createdAt: serverTimestamp(),\n        updatedAt: serverTimestamp(),\n      });\n      router.push(\"/admin/store-items/categories\");\n    } catch (error) {\n      console.error(\"Error creating category:\", error);\n      alert(\"Failed to create category\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <AdminLayout>\n      <div className=\"space-y-6\">\n        <div className=\"mb-8\">\n          <button\n            onClick={() => router.back()}\n            className=\"text-blue-600 hover:text-blue-800 mb-4\"\n          >\n            ‚Üê Back\n          </button>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Add New Category</h1>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"bg-white rounded-lg shadow p-6 max-w-2xl\">\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Name *</label>\n              <input\n                type=\"text\"\n                required\n                value={formData.name}\n                onChange={(e) => {\n                  setFormData({\n                    ...formData,\n                    name: e.target.value,\n                    slug: generateSlug(e.target.value),\n                  });\n                }}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n                placeholder=\"Category Name\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Slug *</label>\n              <input\n                type=\"text\"\n                required\n                value={formData.slug}\n                onChange={(e) => setFormData({ ...formData, slug: e.target.value })}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n                placeholder=\"category-slug\"\n              />\n              <p className=\"text-xs text-gray-500 mt-1\">Auto-generated from name, but can be edited</p>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Parent Category</label>\n              <select\n                value={formData.parentCategoryId}\n                onChange={(e) => setFormData({ ...formData, parentCategoryId: e.target.value })}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n              >\n                <option value=\"\">None (Top Level)</option>\n                {parentCategories.map((cat) => (\n                  <option key={cat.categoryId} value={cat.categoryId}>\n                    {cat.name}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Image (Optional)</label>\n              <FileUpload\n                accept=\"image/*\"\n                folder=\"categories/images\"\n                currentValue={formData.image}\n                onUploadComplete={(url) => {\n                  console.log(\"Upload complete, URL:\", url);\n                  setFormData((prev) => ({ ...prev, image: url }));\n                }}\n                onUploadError={(error) => {\n                  alert(`Upload failed: ${error}`);\n                }}\n              />\n              {formData.image && (\n                <div className=\"mt-4\">\n                  <img\n                    src={formData.image}\n                    alt=\"Category image\"\n                    className=\"w-32 h-32 object-cover border border-gray-300 rounded\"\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => setFormData((prev) => ({ ...prev, image: \"\" }))}\n                    className=\"mt-2 text-sm text-red-600 hover:text-red-800\"\n                  >\n                    Remove Image\n                  </button>\n                </div>\n              )}\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Description (Optional)</label>\n              <textarea\n                rows={4}\n                value={formData.description}\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n                placeholder=\"Category description...\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Order Index</label>\n              <input\n                type=\"number\"\n                value={formData.orderIndex}\n                onChange={(e) => setFormData({ ...formData, orderIndex: parseInt(e.target.value) || 0 })}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n                placeholder=\"0\"\n              />\n              <p className=\"text-xs text-gray-500 mt-1\">Lower numbers appear first</p>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Status *</label>\n              <select\n                required\n                value={formData.status}\n                onChange={(e) => setFormData({ ...formData, status: e.target.value as any })}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n              >\n                <option value=\"active\">Active</option>\n                <option value=\"inactive\">Inactive</option>\n              </select>\n            </div>\n\n            <div className=\"flex gap-4 pt-4\">\n              <button\n                type=\"submit\"\n                disabled={loading}\n                className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50\"\n              >\n                {loading ? \"Creating...\" : \"Create Category\"}\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => router.back()}\n                className=\"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300\"\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    </AdminLayout>\n  );\n}\n\n"],"names":[],"mappings":"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"}