module.exports=[19187,a=>{"use strict";var b=a.i(88398),c=a.i(96600),d=a.i(71852);a.i(55614);var e=a.i(93749),f=a.i(47073),g=a.i(56219),h=a.i(35538),i=a.i(18295),j=a.i(61531);let k=(0,a.i(68618).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var l=a.i(74543);function m(){let a=(0,d.useRouter)(),m=(0,d.useParams)().id,[n,o]=(0,c.useState)(!0),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)({itemId:"",itemType:"physical_product",title:"",shortDescription:"",fullDescription:"",categoryId:"",brandId:"",hasVariants:!1,isDigital:!1,basePrice:"",compareAtPrice:"",taxable:!1,currency:"INR",trackInventory:!0,stockQuantity:"",allowBackorder:!1,lowStockThreshold:"",images:[],videos:[],thumbnailImage:"",location:"",city:"",date:"",startTime:"",endTime:"",capacity:"",meetingUrl:"",includedItems:[],bundlePrice:"",seoTitle:"",seoDescription:"",slug:"",material:"",dimensions:"",warranty:"",ageGroup:"",usageInstructions:"",featured:!1,status:"draft"});(0,c.useEffect)(()=>{B(),C(),F(),D()},[m]);let B=async()=>{try{let a=(0,e.query)((0,e.collection)(f.db,"categories"),(0,e.where)("status","==","active")),b=await (0,e.getDocs)(a),c=[];b.forEach(a=>{c.push({categoryId:a.id,...a.data()})}),s(c)}catch(a){console.error("Error loading categories:",a)}},C=async()=>{try{let a=(0,e.query)((0,e.collection)(f.db,"brands"),(0,e.where)("status","==","active")),b=await (0,e.getDocs)(a),c=[];b.forEach(a=>{c.push({brandId:a.id,...a.data()})}),u(c)}catch(a){console.error("Error loading brands:",a)}},D=async()=>{try{let a=(0,e.query)((0,e.collection)(f.db,"variants"),(0,e.where)("itemId","==",m)),b=await (0,e.getDocs)(a),c=[];b.forEach(a=>{c.push({variantId:a.id,...a.data()})}),y(c);let d=(0,e.doc)(f.db,"store_items",m),g=await (0,e.getDoc)(d);if(g.exists()){let a=g.data();a.variantOptions&&Array.isArray(a.variantOptions)&&w(a.variantOptions)}}catch(a){console.error("Error loading variants:",a)}},E=()=>{if(0===v.length)return void y([]);let a=v.filter(a=>a.name.trim()&&a.values.filter(a=>a.trim()).length>0);if(0===a.length)return void y([]);let b=[];!function c(d,e){if(e===a.length)return void b.push({...d});let f=a[e];for(let a of f.values.filter(a=>a.trim()))d[f.name]=a,c(d,e+1)}({},0),y(b.map((a,b)=>{let c=x.find(b=>{let c=Object.keys(a).sort(),d=Object.keys(b.optionValues).sort();return c.length===d.length&&c.every(c=>a[c]===b.optionValues[c])});return c||{variantId:`temp-${b}`,itemId:m,optionValues:a,price:parseFloat(z.basePrice)||0,sku:`${z.itemId}-${Object.values(a).join("-")}`.toUpperCase(),stockQuantity:0,status:"active",createdAt:new Date,updatedAt:new Date}}))},F=async()=>{try{o(!0);let b=(0,e.doc)(f.db,"store_items",m),c=await (0,e.getDoc)(b);if(!c.exists()){alert("Item not found"),a.push("/admin/store-items");return}let d=c.data();A({itemId:d.itemId||d.item_id||"",itemType:d.itemType||d.type||"physical_product",title:d.title||"",shortDescription:d.shortDescription||"",fullDescription:d.fullDescription||d.description||"",categoryId:d.categoryId||d.category_id||"",brandId:d.brandId||d.brand_id||"",hasVariants:d.hasVariants||!1,isDigital:d.isDigital||"digital_product"===d.itemType||!1,basePrice:d.basePrice?.toString()||d.price?.toString()||"",compareAtPrice:d.compareAtPrice?.toString()||d.compare_at_price?.toString()||d.discount_price?.toString()||"",taxable:d.taxable||d.tax_chargeable||!1,currency:d.currency||"INR",trackInventory:void 0!==d.trackInventory?d.trackInventory:void 0===d.inventory_tracking||d.inventory_tracking,stockQuantity:d.stockQuantity?.toString()||d.quantity?.toString()||"",allowBackorder:d.allowBackorder||d.continue_selling_out_of_stock||!1,lowStockThreshold:d.lowStockThreshold?.toString()||"",images:d.images||[],videos:d.videos||[],thumbnailImage:d.thumbnailImage||d.images?.[0]||"",location:d.location||"",city:d.city||"",date:d.date||"",startTime:d.startTime||"",endTime:d.endTime||"",capacity:d.capacity?.toString()||"",meetingUrl:d.meetingUrl||"",includedItems:d.includedItems||[],bundlePrice:d.bundlePrice?.toString()||"",seoTitle:d.seoTitle||d.seo_title||"",seoDescription:d.seoDescription||d.seo_description||"",slug:d.slug||"",material:d.material||"",dimensions:d.dimensions||"",warranty:d.warranty||"",ageGroup:d.ageGroup||d.age_group||"",usageInstructions:d.usageInstructions||d.usage_instructions||"",featured:d.featured||!1,status:d.status||"draft"})}catch(a){console.error("Error loading item:",a),alert("Failed to load item")}finally{o(!1)}},G=async b=>{b.preventDefault();try{if(q(!0),!z.categoryId)return void alert("Please select a category");let b={itemId:z.itemId,itemType:z.itemType,title:z.title,shortDescription:z.shortDescription||null,fullDescription:z.fullDescription,categoryId:z.categoryId,brandId:z.brandId||null,hasVariants:z.hasVariants,variantOptions:v.length>0?v:null,isDigital:z.isDigital||"digital_product"===z.itemType,basePrice:parseFloat(z.basePrice)||0,compareAtPrice:z.compareAtPrice?parseFloat(z.compareAtPrice):null,taxable:z.taxable,currency:z.currency,trackInventory:z.trackInventory&&"digital_product"!==z.itemType,stockQuantity:z.trackInventory&&z.stockQuantity?parseInt(z.stockQuantity):null,allowBackorder:z.allowBackorder,lowStockThreshold:z.lowStockThreshold?parseInt(z.lowStockThreshold):null,images:z.images,videos:z.videos,thumbnailImage:z.images[0]||z.thumbnailImage||null,location:"workshop"===z.itemType&&z.location?z.location:null,city:"workshop"===z.itemType&&z.city?z.city:null,date:("workshop"===z.itemType||"live_class"===z.itemType)&&z.date?z.date:null,startTime:("workshop"===z.itemType||"live_class"===z.itemType)&&z.startTime?z.startTime:null,endTime:("workshop"===z.itemType||"live_class"===z.itemType)&&z.endTime?z.endTime:null,capacity:("workshop"===z.itemType||"live_class"===z.itemType)&&z.capacity?parseInt(z.capacity):null,meetingUrl:"live_class"===z.itemType&&z.meetingUrl?z.meetingUrl:null,includedItems:"bundle"===z.itemType?z.includedItems:[],bundlePrice:"bundle"===z.itemType&&z.bundlePrice?parseFloat(z.bundlePrice):null,seoTitle:z.seoTitle||z.title,seoDescription:z.seoDescription||z.fullDescription,slug:z.slug||z.title.toLowerCase().replace(/\s+/g,"-"),material:z.material||null,dimensions:z.dimensions||null,warranty:z.warranty||null,ageGroup:z.ageGroup||null,usageInstructions:z.usageInstructions||null,featured:z.featured,status:z.status,updatedAt:(0,e.serverTimestamp)()};if(await (0,e.updateDoc)((0,e.doc)(f.db,"store_items",m),b),z.hasVariants&&x.length>0){let a=(0,e.query)((0,e.collection)(f.db,"variants"),(0,e.where)("itemId","==",m)),b=(await (0,e.getDocs)(a)).docs.map(a=>(0,e.deleteDoc)(a.ref));await Promise.all(b);let c=x.map(a=>{let{variantId:b,...c}=a;return(0,e.addDoc)((0,e.collection)(f.db,"variants"),{...c,itemId:m,createdAt:(0,e.serverTimestamp)(),updatedAt:(0,e.serverTimestamp)()})});await Promise.all(c)}a.push("/admin/store-items")}catch(a){console.error("Error updating item:",a),alert("Failed to update item")}finally{q(!1)}};return n?(0,b.jsx)(g.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)("div",{className:"text-lg",children:"Loading..."})})}):(0,b.jsx)(g.AdminLayout,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("button",{onClick:()=>a.back(),className:"text-blue-600 hover:text-blue-800 mb-4",children:"← Back"}),(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Edit Store Item"})]}),(0,b.jsxs)("form",{onSubmit:G,className:"bg-white rounded-lg shadow p-6 max-w-4xl",children:[(0,b.jsxs)("section",{className:"mb-8 pb-8 border-b",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Basic Information"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Item Type *"}),(0,b.jsxs)("select",{required:!0,value:z.itemType,onChange:a=>{let b=a.target.value;A({...z,itemType:b,isDigital:"digital_product"===b,trackInventory:"digital_product"!==b})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[(0,b.jsx)("option",{value:"physical_product",children:"Physical Product"}),(0,b.jsx)("option",{value:"digital_product",children:"Digital Product"}),(0,b.jsx)("option",{value:"workshop",children:"Workshop"}),(0,b.jsx)("option",{value:"live_class",children:"Live Class"}),(0,b.jsx)("option",{value:"bundle",children:"Bundle"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),(0,b.jsxs)("select",{required:!0,value:z.categoryId,onChange:a=>A({...z,categoryId:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[(0,b.jsx)("option",{value:"",children:"Select a category"}),r.map(a=>(0,b.jsx)("option",{value:a.categoryId,children:a.name},a.categoryId))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Brand (Optional)"}),(0,b.jsxs)("select",{value:z.brandId,onChange:a=>A({...z,brandId:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[(0,b.jsx)("option",{value:"",children:"None"}),t.map(a=>(0,b.jsx)("option",{value:a.brandId,children:a.name},a.brandId))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Item ID *"}),(0,b.jsx)("input",{type:"text",required:!0,value:z.itemId,onChange:a=>A({...z,itemId:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),(0,b.jsx)("input",{type:"text",required:!0,value:z.title,onChange:a=>A({...z,title:a.target.value,slug:a.target.value.toLowerCase().replace(/\s+/g,"-"),seoTitle:z.seoTitle||a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Short Description"}),(0,b.jsx)("input",{type:"text",value:z.shortDescription,onChange:a=>A({...z,shortDescription:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Description *"}),(0,b.jsx)("textarea",{required:!0,rows:6,value:z.fullDescription,onChange:a=>A({...z,fullDescription:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),"physical_product"===z.itemType&&(0,b.jsx)("div",{children:(0,b.jsxs)("label",{className:"flex items-center",children:[(0,b.jsx)("input",{type:"checkbox",checked:z.hasVariants,onChange:a=>A({...z,hasVariants:a.target.checked}),className:"mr-2"}),(0,b.jsx)("span",{className:"text-sm text-gray-700",children:"This product has variants (Size, Color, etc.)"})]})})]})]}),(0,b.jsxs)("section",{className:"mb-8 pb-8 border-b",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Pricing"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Base Price (₹) *"}),(0,b.jsx)("input",{type:"number",required:!0,step:"0.01",value:z.basePrice,onChange:a=>A({...z,basePrice:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Compare at Price (₹)"}),(0,b.jsx)("input",{type:"number",step:"0.01",value:z.compareAtPrice,onChange:a=>A({...z,compareAtPrice:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),(0,b.jsxs)("select",{value:z.currency,onChange:a=>A({...z,currency:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[(0,b.jsx)("option",{value:"INR",children:"INR (₹)"}),(0,b.jsx)("option",{value:"USD",children:"USD ($)"}),(0,b.jsx)("option",{value:"EUR",children:"EUR (€)"})]})]}),(0,b.jsx)("div",{className:"flex items-end",children:(0,b.jsxs)("label",{className:"flex items-center",children:[(0,b.jsx)("input",{type:"checkbox",checked:z.taxable,onChange:a=>A({...z,taxable:a.target.checked}),className:"mr-2"}),(0,b.jsx)("span",{className:"text-sm text-gray-700",children:"Taxable"})]})})]})]}),(0,b.jsxs)("section",{className:"mb-8 pb-8 border-b",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Media"}),(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Images"}),(0,b.jsx)(h.FileUpload,{accept:"image/*",folder:"products/images",multiple:!0,onUploadComplete:a=>{z.images.includes(a)||A({...z,images:[...z.images,a]})},onUploadError:a=>alert(`Upload failed: ${a}`)}),(0,b.jsx)("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4",children:z.images.map((a,c)=>(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)(i.S3Image,{src:a,alt:`Image ${c+1}`,className:"w-full h-32 object-cover rounded-lg border"}),(0,b.jsx)("button",{type:"button",onClick:()=>A({...z,images:z.images.filter((a,b)=>b!==c)}),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 opacity-0 group-hover:opacity-100",children:"×"})]},c))})]})})]}),z.hasVariants&&(0,b.jsxs)("section",{className:"mb-8 pb-8 border-b",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Variant Management"}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-medium mb-3",children:"Variant Options"}),(0,b.jsxs)("div",{className:"space-y-4",children:[v.map((a,c)=>(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("input",{type:"text",value:a.name,onChange:a=>{let b=[...v];b[c].name=a.target.value,w(b)},className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg mr-2",placeholder:"Option name (e.g., Size, Color)"}),(0,b.jsx)("button",{type:"button",onClick:()=>{w(v.filter((a,b)=>b!==c)),E()},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:(0,b.jsx)(l.Trash2,{className:"w-5 h-5"})})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[a.values.map((a,d)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-3 py-1 rounded-lg",children:[(0,b.jsx)("input",{type:"text",value:a,onChange:a=>{let b=[...v];b[c].values[d]=a.target.value,w(b)},className:"bg-transparent border-none outline-none text-sm",placeholder:"Value"}),(0,b.jsx)("button",{type:"button",onClick:()=>{let a=[...v];a[c].values=a[c].values.filter((a,b)=>b!==d),w(a),E()},className:"text-red-600 hover:text-red-800",children:(0,b.jsx)(k,{className:"w-4 h-4"})})]},d)),(0,b.jsx)("button",{type:"button",onClick:()=>{let a=[...v];a[c].values.push(""),w(a)},className:"px-3 py-1 border border-gray-300 rounded-lg text-sm hover:bg-gray-100",children:"+ Add Value"})]})]},c)),(0,b.jsxs)("button",{type:"button",onClick:()=>{w([...v,{name:"",values:[""]}])},className:"px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-100 flex items-center gap-2",children:[(0,b.jsx)(j.Plus,{className:"w-4 h-4"}),"Add Variant Option"]}),v.length>0&&(0,b.jsx)("button",{type:"button",onClick:E,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Generate Variants"})]})]}),x.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-lg font-medium mb-3",children:["Generated Variants (",x.length,")"]}),(0,b.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:x.map((a,c)=>(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Options"}),(0,b.jsx)("div",{className:"text-sm font-medium",children:Object.entries(a.optionValues).map(([a,c])=>(0,b.jsxs)("span",{className:"mr-2",children:[a,": ",c]},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Price (₹)"}),(0,b.jsx)("input",{type:"number",step:"0.01",value:a.price,onChange:a=>{let b=[...x];b[c].price=parseFloat(a.target.value)||0,y(b)},className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"SKU"}),(0,b.jsx)("input",{type:"text",value:a.sku,onChange:a=>{let b=[...x];b[c].sku=a.target.value,y(b)},className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Stock"}),(0,b.jsx)("input",{type:"number",value:a.stockQuantity,onChange:a=>{let b=[...x];b[c].stockQuantity=parseInt(a.target.value)||0,y(b)},className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})]})]}),(0,b.jsxs)("div",{className:"mt-2 flex items-center gap-4",children:[(0,b.jsxs)("label",{className:"flex items-center text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:"active"===a.status,onChange:a=>{let b=[...x];b[c].status=a.target.checked?"active":"inactive",y(b)},className:"mr-2"}),"Active"]}),(0,b.jsx)("button",{type:"button",onClick:()=>{y(x.filter((a,b)=>b!==c))},className:"text-red-600 hover:text-red-800 text-sm",children:"Remove"})]})]},c))})]})]})]}),(0,b.jsxs)("section",{className:"mb-8",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Status"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex items-center gap-6",children:(0,b.jsxs)("label",{className:"flex items-center",children:[(0,b.jsx)("input",{type:"checkbox",checked:z.featured,onChange:a=>A({...z,featured:a.target.checked}),className:"mr-2"}),(0,b.jsx)("span",{className:"text-sm text-gray-700",children:"Featured"})]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status *"}),(0,b.jsxs)("select",{required:!0,value:z.status,onChange:a=>A({...z,status:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[(0,b.jsx)("option",{value:"draft",children:"Draft"}),(0,b.jsx)("option",{value:"active",children:"Active"}),(0,b.jsx)("option",{value:"inactive",children:"Inactive"})]})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,b.jsx)("button",{type:"submit",disabled:p,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:p?"Saving...":"Save Changes"}),(0,b.jsx)("button",{type:"button",onClick:()=>a.back(),className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]})})}a.s(["default",()=>m],19187)}];

//# sourceMappingURL=2f7c9_lms-ecommerce_web_src_app_admin_store-items_%5Bid%5D_edit_page_tsx_3136fd67._.js.map