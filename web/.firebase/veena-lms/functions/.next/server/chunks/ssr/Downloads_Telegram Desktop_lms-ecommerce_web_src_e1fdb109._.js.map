{"version":3,"sources":["../../../../../../../../Downloads/Telegram%20Desktop/lms-ecommerce/web/src/lib/s3ImageHelper.ts","../../../../../../../../Downloads/Telegram%20Desktop/lms-ecommerce/web/src/components/common/S3Image.tsx"],"sourcesContent":["/**\n * Helper function to get signed S3 URLs for images\n * This is needed because S3 objects with KMS encryption require signed URLs\n */\n\nexport async function getSignedImageUrl(imageUrl: string): Promise<string> {\n  // If it's not an S3 URL, return as-is\n  if (!imageUrl || (!imageUrl.includes(\"s3\") && !imageUrl.includes(\"amazonaws.com\"))) {\n    return imageUrl;\n  }\n\n  try {\n    // Pass the full URL as-is; the API will extract the S3 object key\n    const response = await fetch(`/api/s3-signed-url?key=${encodeURIComponent(imageUrl)}`);\n    \n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error(\"Failed to get signed URL:\", {\n        status: response.status,\n        statusText: response.statusText,\n        error: errorText,\n        imageUrl: imageUrl\n      });\n      return imageUrl; // Fallback to original URL\n    }\n\n    const data = await response.json();\n    if (data.error) {\n      console.error(\"Signed URL API error:\", data.error);\n      return imageUrl; // Fallback to original URL\n    }\n    return data.url || imageUrl;\n  } catch (error) {\n    console.error(\"Error getting signed URL:\", error);\n    return imageUrl; // Fallback to original URL\n  }\n}\n\n/**\n * Get signed URLs for multiple images\n */\nexport async function getSignedImageUrls(imageUrls: string[]): Promise<string[]> {\n  return Promise.all(imageUrls.map(url => getSignedImageUrl(url)));\n}\n\n","\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { getSignedImageUrl } from \"@/lib/s3ImageHelper\";\n\ninterface S3ImageProps {\n  src: string;\n  alt: string;\n  className?: string;\n  fallback?: React.ReactNode;\n}\n\nexport function S3Image({ src, alt, className = \"\", fallback }: S3ImageProps) {\n  const [imageUrl, setImageUrl] = useState<string>(src);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(false);\n  const [errorMessage, setErrorMessage] = useState<string>(\"\");\n\n  useEffect(() => {\n    // Handle empty or invalid src\n    if (!src || src.trim() === \"\") {\n      setError(true);\n      setLoading(false);\n      return;\n    }\n\n    // Only get signed URL if it's an S3 URL\n    if (src.includes(\"s3\") || src.includes(\"amazonaws.com\")) {\n      getSignedImageUrl(src)\n        .then((signedUrl) => {\n          setImageUrl(signedUrl);\n          setLoading(false);\n        })\n        .catch((err) => {\n          // Fallback to original URL - might work if bucket has public read access\n          setImageUrl(src);\n          setLoading(false);\n        });\n    } else {\n      // Not an S3 URL, use as-is\n      setImageUrl(src);\n      setLoading(false);\n    }\n  }, [src]);\n\n  if (error) {\n    return (\n      <div className={className}>\n        {fallback || (\n          <div className=\"w-full h-full flex items-center justify-center text-gray-400 bg-gray-100\">\n            <svg className=\"w-16 h-16\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n            </svg>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <img\n        src={imageUrl}\n        alt={alt}\n        className={className}\n        onError={(e) => {\n          // Silently handle image load errors - don't spam console\n          if (process.env.NODE_ENV === \"development\") {\n            console.warn(\"S3Image: Image failed to load\", imageUrl);\n          }\n          setError(true);\n          setErrorMessage(\"Failed to load image\");\n        }}\n        onLoad={() => {\n          setLoading(false);\n          setError(false);\n        }}\n        style={{ opacity: loading ? 0.5 : 1 }}\n      />\n      {error && process.env.NODE_ENV === \"development\" && (\n        <div className=\"text-xs text-red-500 mt-1\">\n          Image load failed. Check console for details.\n        </div>\n      )}\n    </>\n  );\n}\n\n\n\n"],"names":[],"mappings":"uCAKO,eAAe,EAAkB,CAAgB,EAEtD,GAAI,CAAC,GAAa,CAAC,EAAS,QAAQ,CAAC,OAAS,CAAC,EAAS,QAAQ,CAAC,iBAC/D,CADkF,MAC3E,EAGT,GAAI,CAEF,IAAM,EAAW,MAAM,MAAM,CAAC,uBAAuB,EAAE,mBAAmB,GAAA,CAAW,EAErF,GAAI,CAAC,EAAS,EAAE,CAAE,CAChB,IAAM,EAAY,MAAM,EAAS,IAAI,GAOrC,OANA,QAAQ,KAAK,CAAC,4BAA6B,CACzC,OAAQ,EAAS,MAAM,CACvB,WAAY,EAAS,UAAU,CAC/B,MAAO,EACP,SAAU,CACZ,GACO,CACT,CAEA,IAAM,EAAO,EAHM,IAGA,EAAS,IAAI,GAChC,GAAI,EAAK,KAAK,CAEZ,CAFc,EAJ8B,IAK5C,QAAQ,KAAK,CAAC,wBAAyB,EAAK,KAAK,EAC1C,EAET,OAAO,CAFY,CAEP,GAAG,EAAI,CACrB,CAAE,MAAO,EAAO,CAEd,OADA,GAJ8C,KAItC,KAAK,CAAC,4BAA6B,GACpC,CACT,CACF,QAFqB,2BAA2B,wCChChD,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OASO,SAAS,EAAQ,KAAE,CAAG,KAAE,CAAG,WAAE,EAAY,EAAE,UAAE,CAAQ,CAAgB,EAC1E,GAAM,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAS,GAC3C,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACjC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAC7B,CAAC,EAAc,EAAgB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAS,UA6BzD,CA3BA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KAER,GAAI,CAAC,GAAsB,KAAf,EAAI,IAAI,GAAW,CAC7B,GAAS,GACT,EAAW,IACX,MACF,CAGI,EAAI,QAAQ,CAAC,OAAS,EAAI,QAAQ,CAAC,iBACrC,CADuD,AACvD,EAAA,EAAA,iBAAA,AAAiB,EAAC,GACf,IAAI,CAAC,AAAC,IACL,EAAY,GACZ,GAAW,EACb,GACC,KAAK,CAAC,AAAC,IAEN,EAAY,GACZ,GAAW,EACb,IAGF,EAAY,GACZ,GAAW,GAEf,EAAG,CAAC,EAAI,EAEJ,GAEA,CAAA,EAAA,CAFO,CAEP,GAAA,EAAC,MAAA,CAAI,UAAW,WACb,GACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oFACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,YAAY,KAAK,OAAO,OAAO,eAAe,QAAQ,qBACnE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,oKAS/E,CAAA,EAAA,EAAA,IAAA,EAAA,EAAA,QAAA,CAAA,WACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,IAAK,EACL,IAAK,EACL,UAAW,EACX,QAAS,AAAC,IAKR,GAAS,GACT,EAAgB,uBAClB,EACA,OAAQ,KACN,GAAW,GACX,GAAS,EACX,EACA,MAAO,CAAE,QAAS,EAAU,GAAM,CAAE,IAErC,IAAS,IAOhB,+CAPyC,+BACjC,mDAAC"}